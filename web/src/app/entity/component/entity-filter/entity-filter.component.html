<div matDialogContent class="content">
  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="filter-tree">

    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle class="filter-node">
      <mat-checkbox class="negate" [(ngModel)]="node.negate">Not</mat-checkbox>
      {{node.expression?.field}} {{operatorLabel(node.expression?.operator)}} {{node.expression?.value}}
      <div class="filler"></div>
      <button mat-icon-button [matMenuTriggerFor]="expressionMenu"><mat-icon>more_vert</mat-icon></button>
      <mat-menu #expressionMenu>
        <button mat-menu-item (click)="edit(node)">Edit</button>
        <button mat-menu-item (click)="delete(node)">Delete</button>
      </mat-menu>
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
      <div class="filter-node">
        <button mat-icon-button matTreeNodeToggle [disabled]="node.children.length == 0">
          <mat-icon>{{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}</mat-icon>
        </button>
        <mat-checkbox class="negate" [(ngModel)]="node.negate">Not</mat-checkbox>
        <mat-button-toggle-group [(ngModel)]="node.condition">
          <mat-button-toggle [value]="'AND'">And</mat-button-toggle>
          <mat-button-toggle [value]="'OR'">Or</mat-button-toggle>
        </mat-button-toggle-group>
        <div class="filler"></div>
        <button mat-icon-button [matMenuTriggerFor]="conditionMenu"><mat-icon>more_vert</mat-icon></button>
        <mat-menu #conditionMenu>
          <button mat-menu-item (click)="addCondition(node)">Add condition</button>
          <button mat-menu-item (click)="addExpression(node)">Add expression</button>
          @if (!isRoot(node)) {
            <button mat-menu-item (click)="delete(node)">Delete</button>
          }
        </mat-menu>
      </div>
      <div [hidden]="!treeControl.isExpanded(node)" role="group">
        <ng-container matTreeNodeOutlet></ng-container>
      </div>
    </mat-nested-tree-node>

  </mat-tree>
</div>
<div matDialogActions>
  <button mat-raised-button color="primary" (click)="apply()">Apply</button>
  <button mat-button (click)="close()">Close</button>
</div>
