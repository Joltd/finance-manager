<div matDialogContent class="content">
  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">

    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
      Test {{node.expression?.field}} {{node.expression?.operator}} {{node.expression?.value}}
      <button mat-icon-button [matMenuTriggerFor]="expressionMenu"><mat-icon>more_vert</mat-icon></button>
      <mat-menu #expressionMenu>
        <button mat-menu-item (click)="edit(node)">Edit</button>
        <button mat-menu-item (click)="delete(node)">Delete</button>
      </mat-menu>
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
      <div class="filter-node">
        <button mat-icon-button matTreeNodeToggle>
          <mat-icon>{{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}</mat-icon>
        </button>
        {{node.condition}}
        <button mat-icon-button [matMenuTriggerFor]="conditionMenu"><mat-icon>more_vert</mat-icon></button>
        <mat-menu #conditionMenu>
          <button mat-menu-item (click)="addCondition(node)">Add condition</button>
          <button mat-menu-item (click)="addExpression(node)">Add expression</button>
          <button mat-menu-item (click)="delete(node)">Delete</button>
        </mat-menu>
      </div>
      <div [hidden]="!treeControl.isExpanded(node)">
        <ng-container matTreeNodeOutlet></ng-container>
      </div>
    </mat-nested-tree-node>

  </mat-tree>
</div>
<div matDialogActions>
  <button mat-raised-button color="primary" (click)="apply()">Apply</button>
  <button mat-button (click)="close()">Close</button>
</div>
